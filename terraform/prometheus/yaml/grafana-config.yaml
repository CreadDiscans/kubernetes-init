
apiVersion: v1
kind: Secret
metadata:
  labels:
    app.kubernetes.io/component: grafana
    app.kubernetes.io/name: grafana
    app.kubernetes.io/part-of: kube-prometheus
    app.kubernetes.io/version: 9.5.3
  name: grafana-config
  namespace: monitoring
stringData:
  grafana.ini: |
    [date_formats]
    default_timezone = UTC
    [server]
    root_url = https://grafana.${domain}
    [auth]
    signout_redirect_url = https://keycloak.${domain}/realms/master/protocol/openid-connect/logout
    disable_login_form = true
    [auth.generic_oauth]
    enabled = true
    name = Keycloak-OAuth
    allow_sign_up = true
    client_id = ${client_id}
    client_secret = ${client_secret}
    scopes = openid email profile offline_access
    email_attribute_path = email
    login_attribute_path = username
    name_attribute_path = full_name
    auth_url = https://keycloak.${domain}/realms/master/protocol/openid-connect/auth
    token_url = https://keycloak.${domain}/realms/master/protocol/openid-connect/token
    api_url = https://keycloak.${domain}/realms/master/protocol/openid-connect/userinfo
    role_attribute_path: contains(groups[*], '/grafana') && 'Admin' || 'Viewer'
    tls_skip_verify_insecure = false
    tls_client_cert = /etc/keycloak/ssl/tls.crt
    tls_client_key = /etc/keycloak/ssl/tls.key
    tls_client_ca = /etc/keycloak/ssl/tls.crt
type: Opaque
